{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/uncommonstudent/Desktop/Software%20Dev%20Specialization/peak-commerce-app/frontend/context/CartContext.tsx"],"sourcesContent":["// context/CartContext.tsx\r\n\"use client\"\r\n\r\nimport React, { createContext, useContext, useState, useMemo, ReactNode, useEffect } from \"react\"\r\n\r\n// Define the shape of a product in the cart\r\ninterface CartItem {\r\n  id: number\r\n  name: string\r\n  price: number\r\n  image: string\r\n  category?: string\r\n  quantity: number\r\n  stock?: number\r\n}\r\n\r\n// Define the shape of the context\r\ninterface CartContextType {\r\n  cart: CartItem[]\r\n  // allow specifying a quantity when adding to cart\r\n  addToCart: (product: Omit<CartItem, 'quantity'>, quantity?: number) => void\r\n  removeFromCart: (productId: number) => void\r\n  updateQuantity: (productId: number, newQuantity: number) => void\r\n  clearCart: () => void\r\n  totalItems: number\r\n  totalPrice: number\r\n  isLoading: boolean\r\n  error: string | null\r\n}\r\n\r\n// Create the context\r\nconst CartContext = createContext<CartContextType | undefined>(undefined)\r\n\r\nconst CART_STORAGE_KEY = 'peak-commerce-cart'\r\n\r\n// Provider component\r\nexport const CartProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\r\n  const [cart, setCart] = useState<CartItem[]>([])\r\n  const [isLoading, setIsLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  // Load cart from localStorage on mount\r\n  useEffect(() => {\r\n    try {\r\n      const storedCart = localStorage.getItem(CART_STORAGE_KEY)\r\n      if (storedCart) {\r\n        setCart(JSON.parse(storedCart))\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to load cart from localStorage:', err)\r\n      setError('Failed to load cart')\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  // Save cart to localStorage whenever it changes\r\n  useEffect(() => {\r\n    if (!isLoading) {\r\n      try {\r\n        localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart))\r\n      } catch (err) {\r\n        console.error('Failed to save cart to localStorage:', err)\r\n        setError('Failed to save cart')\r\n      }\r\n    }\r\n  }, [cart, isLoading])\r\n\r\n  // Function to add a product to the cart (or increment quantity if it exists)\r\n  const addToCart = (product: Omit<CartItem, 'quantity'>, quantity: number = 1) => {\r\n    setCart(currentCart => {\r\n      const existingItem = currentCart.find(item => item.id === product.id)\r\n\r\n      if (existingItem) {\r\n        // Check stock availability\r\n        const maxQuantity = product.stock || Infinity\r\n        const newQuantity = Math.min(existingItem.quantity + quantity, maxQuantity)\r\n\r\n        if (newQuantity > existingItem.quantity) {\r\n          return currentCart.map(item =>\r\n            item.id === product.id ? { ...item, quantity: newQuantity } : item\r\n          )\r\n        }\r\n\r\n        setError('Not enough stock available')\r\n        return currentCart\r\n      } else {\r\n        // Add new product with requested quantity (bounded by stock)\r\n        const allowedQuantity = Math.min(quantity, product.stock || quantity)\r\n        return [...currentCart, { ...product, quantity: allowedQuantity }]\r\n      }\r\n    })\r\n  }\r\n\r\n  // Function to remove a product completely\r\n  const removeFromCart = (productId: number) => {\r\n    setCart(currentCart => currentCart.filter(item => item.id !== productId))\r\n  }\r\n\r\n  // Function to clear entire cart\r\n  const clearCart = () => {\r\n    setCart([])\r\n  }\r\n\r\n  // Function to update the quantity of a product\r\n  const updateQuantity = (productId: number, newQuantity: number) => {\r\n    setCart(currentCart => {\r\n      if (newQuantity <= 0) {\r\n        // If quantity is zero or less, remove the item\r\n        return currentCart.filter(item => item.id !== productId)\r\n      }\r\n      \r\n      // Check stock availability\r\n      const item = currentCart.find(item => item.id === productId)\r\n      if (item && item.stock && newQuantity > item.stock) {\r\n        setError(`Cannot add more than ${item.stock} items. Only ${item.stock} in stock.`)\r\n        return currentCart\r\n      }\r\n      \r\n      return currentCart.map(item => \r\n        item.id === productId ? { ...item, quantity: newQuantity } : item\r\n      )\r\n    })\r\n  }\r\n\r\n  // Calculate total number of items and total price\r\n  const { totalItems, totalPrice } = useMemo(() => {\r\n    const items = cart.reduce((sum, item) => sum + item.quantity, 0)\r\n    const price = cart.reduce((sum, item) => sum + item.price * item.quantity, 0)\r\n    return { totalItems: items, totalPrice: price }\r\n  }, [cart])\r\n\r\n  const contextValue = useMemo(() => ({\r\n    cart,\r\n    addToCart,\r\n    removeFromCart,\r\n    clearCart,\r\n    updateQuantity,\r\n    totalItems,\r\n    totalPrice,\r\n    isLoading,\r\n    error,\r\n  }), [cart, totalItems, totalPrice, isLoading, error])\r\n\r\n  return (\r\n    <CartContext.Provider value={contextValue}>\r\n      {children}\r\n    </CartContext.Provider>\r\n  )\r\n}\r\n\r\n// Custom hook to use the cart context\r\nexport const useCart = () => {\r\n  const context = useContext(CartContext)\r\n  if (context === undefined) {\r\n    throw new Error('useCart must be used within a CartProvider')\r\n  }\r\n  return context\r\n}"],"names":[],"mappings":"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"}}]
}